import * as React from 'react';
import Head from 'next/head';
import CountryServer from '../../../components/Dedicated/CountryServers/CountryServers';
import Footer from '../../../components/Footer/Footer';
import Navbar from '../../../components/Navbar/Navbar';
import { countries } from '../../../components/Dedicated/lib/countries';

export interface IndexProps {
  countryPlans: {
    status: boolean;
    recommended: [];
    plans: {
      id: number;
      title: string;
      price: number;
      datacenter: { title: string; country: { code: string; name: string } };
      hard: [
        [{ type: string; space: number; price: number; onsell?: boolean }],
        [{ type: string; space: number; price: number; onsell?: boolean }]
      ];
      cpu: {
        type: string;
        title: string;
        cores: number;
        threads: number;
        speed: number;
        num: number;
      };
      bandwidth: number;
      port: number;
      ram: number;
      raid: null;
      setup: number;
      currency: { id: number; title: string; update_at: number };
      sold_out: number;
      status: number;
    }[];
  };
  country: string;
}

export interface IndexState {}

class Index extends React.Component<IndexProps, IndexState> {
  constructor(props: IndexProps) {
    super(props);
    this.state = {};
  }
  render() {
    return (
      <div dir="rtl">
        <Head>
          <title>
            سرور اختصاصی{' '}
            {
              countries[
                this.props.countryPlans.plans[0].datacenter.country.code
              ].title_fa
            }
          </title>
          <meta name="description" content="Generated by create next app" />
          <link rel="icon" href="/favicon.ico" />
        </Head>

        <Navbar />

        <CountryServer countryPlans={this.props.countryPlans} />
        <Footer />
      </div>
    );
  }
}

export async function getServerSideProps(context) {
  const country = context.query.country;

  const countryPlansRes = await fetch(
    `${process.env.SCHEMA}://${process.env.DOMAIN}/fa/server/dedicated/${country}?ajax=1`
  );
  const countryPlans = await countryPlansRes.json();

  if (!countryPlans.plans) {
    return {
      notFound: true,
    };
  }

  return {
    props: {
      countryPlans: countryPlans,
      country: country,
    },
  };
}

export default Index;
